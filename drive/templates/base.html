{% load static %}

<!DOCTYPE html>
<html lang="en_US">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %}</title>

    <!-- Tailwindcss Compiled -->
    <!-- <link rel="stylesheet" href="{% static './css/tailwindcss.css' %}"> -->

    <!-- Tailwindcss CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>

<body class="bg-zinc-900">
    <!-- Pop-up de alertas do site -->
    {% if messages %}
    <div id="messages-container" class="fixed top-5 right-5 space-y-2 z-50">
        {% for msg in messages %}
        <div
            class="popup-message px-4 py-2 rounded shadow-md transition-opacity duration-500 {% if msg.tags == 'success' %}bg-green-500 text-white {% elif msg.tags == 'error' %}bg-red-500 text-white {% elif msg.tags == 'warning' %}bg-yellow-500 text-black {% elif msg.tags == 'info' %}bg-blue-500 text-white {% else %}bg-gray-500 text-white{% endif %}">
            {{ msg }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <!-- Cabeçalho do sistema -->
    <div class="w-full bg-zinc-950 text-center p-2 shadow-md">
        <h1 class="text-white">File Browser, powered by Astraeus</h1>
    </div>

    <!-- Conteúdo do sistema -->
    {% block content %}{% endblock %}

    <!-- Scripts JS -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const selectAll = document.getElementById("select-all");

            // Quando o "Selecionar Tudo" for clicado
            selectAll.addEventListener("change", () => {
                // Seleciona apenas as linhas visíveis (as que a pesquisa não ocultou)
                const visibleRows = document.querySelectorAll('tbody tr:not([style*="display: none"])');

                visibleRows.forEach(row => {
                    const checkbox = row.querySelector('input[name="files"]');
                    if (checkbox) checkbox.checked = selectAll.checked;
                });
            });

            // Reativa o botão "Selecionar Tudo" após nova pesquisa
            const searchInput = document.getElementById("search-files");
            if (searchInput) {
                searchInput.addEventListener("input", () => {
                    // Quando fizer uma nova pesquisa, desmarca o select-all
                    selectAll.checked = false;
                });
            }
        });

        // Função de pesquisa do sistema
        function enableSearch(inputId, targetSelector) {
            const searchInput = document.getElementById(inputId);

            if (!searchInput) return;

            searchInput.addEventListener("input", function () {
                const term = this.value.toLowerCase();
                const lines = document.querySelectorAll(targetSelector);

                lines.forEach((line) => {
                    const text = line.textContent.toLowerCase();
                    line.style.display = text.includes(term) ? "" : "none";
                });
            });
        }
        // Ativa a pesquisa na tabela
        document.addEventListener("DOMContentLoaded", function () {
            enableSearch("search-files", "tbody tr");
        });
    </script>
</body>

</html>